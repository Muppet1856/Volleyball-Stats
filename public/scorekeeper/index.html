<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scorekeeper | Volleyball Stats</title>
  <link rel="icon" type="image/svg+xml" sizes="any" href="/volleyball.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180.png">
  <link rel="manifest" href="/site.webmanifest">
  <script>
    (() => {
      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      const applyTheme = (theme) => {
        document.documentElement.setAttribute('data-bs-theme', theme);
        if (document.body) {
          document.body.setAttribute('data-bs-theme', theme);
        } else {
          document.addEventListener(
            'DOMContentLoaded',
            () => document.body?.setAttribute('data-bs-theme', theme),
            { once: true }
          );
        }
      };
      const updateTheme = () => {
        applyTheme(mediaQuery.matches ? 'dark' : 'light');
      };
      updateTheme();
      if (typeof mediaQuery.addEventListener === 'function') {
        mediaQuery.addEventListener('change', updateTheme);
      } else if (typeof mediaQuery.addListener === 'function') {
        mediaQuery.addListener(updateTheme);
      }
    })();
  </script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/volleyball_stats.css">
</head>
  <body class="scorekeeper-page">
  <div class="scorekeeper-shell">
    <div
      id="wsConnectionIndicator"
      class="ws-connection-indicator user-select-none"
      role="status"
      aria-live="polite"
      aria-label="WebSocket connection status"
    >
      <span class="ws-indicator-icon text-danger pulse" aria-hidden="true">
        <i class="bi bi-dash-circle"></i>
      </span>
      <span class="ws-indicator-label">Disconnected</span>
    </div>
    <div class="scorekeeper-top d-flex flex-column align-items-center gap-2 mb-3 text-center">
      <button
        type="button"
        class="btn btn-outline-secondary"
        data-bs-toggle="modal"
        data-bs-target="#matchIndexModal"
      >
        Select Match
      </button>
    </div>

    <section class="scorekeeper-card mb-3">
      <div class="set-carousel" aria-label="Set selector">
        <button
          type="button"
          class="set-carousel-nav btn btn-outline-secondary"
          id="setCarouselPrev"
          aria-label="Previous set"
        >
          <i class="bi bi-chevron-left"></i>
        </button>
        <div class="set-carousel-viewport" id="setCarouselViewport">
          <div id="setCarouselTrack" class="set-carousel-track" role="listbox" aria-label="Swipe to choose a set"></div>
        </div>
        <button
          type="button"
          class="set-carousel-nav btn btn-outline-secondary"
          id="setCarouselNext"
          aria-label="Next set"
        >
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </section>

    <section class="scorekeeper-card scorekeeper-board">
      <div class="d-flex flex-column align-items-center gap-3 mb-3 text-center">
        <button
          type="button"
          class="btn btn-success"
          id="finalizeSetBtn"
          data-bs-toggle="popover"
          data-bs-placement="top"
          data-bs-trigger="manual"
          data-bs-content="Scores must differ to finalize the set."
        >
          Finalize set
        </button>
      </div>

      <div id="scoreGameModal" class="score-modal" data-current-set="1">
        <div class="scoreboard-wrapper">
          <button type="button" class="btn btn-light modal-swap-btn swap-btn" id="scoreModalSwapBtn" aria-label="Swap team sides"></button>
          <div class="team-panel team-blue">
            <span class="score-team-label" data-home-team-template="{homeTeam}" id="scoreGameLeftLabel">Home Team</span>
            <div
              class="score-zone increment"
              tabindex="0"
              role="button"
              data-team="home"
              data-action="increment"
              aria-label="Increase Home score"
            ></div>
            <div
              class="score-zone decrement"
              tabindex="0"
              role="button"
              data-team="home"
              data-action="decrement"
              aria-label="Decrease Home score"
            ></div>
            <div class="score-value" id="scoreGameHomeDisplay">00</div>
          </div>
          <div class="team-panel team-red">
            <span class="score-team-label" data-opp-team-template="{oppTeam}" id="scoreGameRightLabel">Opponent</span>
            <div
              class="score-zone increment"
              tabindex="0"
              role="button"
              data-team="opp"
              data-action="increment"
              aria-label="Increase Opponent score"
            ></div>
            <div
              class="score-zone decrement"
              tabindex="0"
              role="button"
              data-team="opp"
              data-action="decrement"
              aria-label="Decrease Opponent score"
            ></div>
            <div class="score-value" id="scoreGameOppDisplay">00</div>
          </div>
        </div>
        <div class="score-instruction" id="setMessage">Use the touch zones to adjust the score.</div>

        <div class="timeout-row" role="group" aria-label="Timeout controls">
          <div class="timeout-bar">
            <div class="timeout-container left-timeout" data-team="home" aria-label="Home Team timeouts">
              <div class="timeout-boxes">
                <button type="button" class="timeout-box btn" data-team="home" data-timeout-index="0" aria-pressed="false" aria-label="Home Team first timeout available">
                  <span class="timeout-box-text">TO</span>
                </button>
                <button type="button" class="timeout-box btn" data-team="home" data-timeout-index="1" aria-pressed="false" aria-label="Home Team second timeout available">
                  <span class="timeout-box-text">TO</span>
                </button>
              </div>
            </div>
            <div class="timeout-container right-timeout" data-team="opp" aria-label="Opponent timeouts">
              <div class="timeout-boxes">
                <button type="button" class="timeout-box btn" data-team="opp" data-timeout-index="0" aria-pressed="false" aria-label="Opponent first timeout available">
                  <span class="timeout-box-text">TO</span>
                </button>
                <button type="button" class="timeout-box btn" data-team="opp" data-timeout-index="1" aria-pressed="false" aria-label="Opponent second timeout available">
                  <span class="timeout-box-text">TO</span>
                </button>
              </div>
            </div>
          </div>
          <div id="scoreGameTimeoutDisplay" class="timeout-timer-display" role="status" aria-live="polite"></div>
          <div id="timeoutContainer" class="mt-4 position-relative" style="height: 30px; display: none;" aria-live="polite" aria-atomic="true">
            <div class="progress w-100 h-100" style="direction: rtl;">
              <div
                id="scoreGameTimeoutSrStatus"
                class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                role="progressbar"
                aria-valuemin="0"
                aria-valuemax="60"
                aria-valuenow="60"
                style="width: 100%; transition: width 1s linear;"
              ></div>
            </div>
            <div
              id="timeoutCenteredLabel"
              class="position-absolute top-50 start-50 translate-middle fw-bold"
              style="pointer-events: none;"
            >
              1:00
            </div>
          </div>
        </div>
      </div>
    </section>

    <div id="matchIndexModal" class="modal fade" tabindex="-1" aria-labelledby="matchIndexModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg modal-fullscreen-sm-down">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="matchIndexModalLabel">Select Match</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="matchList" class="match-list"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="confirmDeleteModal" class="modal fade" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="confirmDeleteModalLabel">Delete Match</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p id="confirmDeleteModalMessage" class="mb-1">Are you sure you want to delete this match?</p>
            <p class="text-muted small mb-0">This is permanent and cannot be restored.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmDeleteModalConfirmBtn">Delete match</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="../js/scorekeeper.js" defer></script>
</body>
</html>
